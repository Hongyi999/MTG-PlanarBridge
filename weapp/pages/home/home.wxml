<!-- Home Page: 1:1 replica of React home.tsx + App.tsx Layout -->
<view class="page-container" bindtap="closeGameMenu">

  <!-- ===== Sticky Header with Game Selector (matches React Layout header) ===== -->
  <view class="sticky-header">
    <view class="game-selector-wrap" catchtap="toggleGameMenu">
      <view class="game-selector-btn">
        <text class="game-selector-icon">{{currentGame === 'fab' ? 'FAB' : 'MTG'}}</text>
        <text class="game-chevron {{showGameMenu ? 'chevron-up' : ''}}">â–¾</text>
      </view>
      <!-- Dropdown -->
      <view wx:if="{{showGameMenu}}" class="game-dropdown" catchtap="noop">
        <view
          wx:for="{{games}}"
          wx:key="key"
          class="game-option {{currentGame === item.key ? 'game-option-active' : ''}}"
          data-key="{{item.key}}"
          catchtap="selectGame"
        >
          <text class="game-opt-icon {{currentGame === item.key ? 'game-opt-active' : 'game-opt-muted'}}">{{item.icon}}</text>
          <view>
            <text class="game-opt-cn {{currentGame === item.key ? 'game-opt-active' : ''}}">{{item.nameCn}}</text>
            <text class="game-opt-en">{{item.name}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="header-ornament">
      <view class="orn-dot"></view>
      <view class="orn-dot"></view>
      <view class="orn-dot"></view>
      <view class="orn-sep"></view>
      <view class="orn-ring"></view>
    </view>
  </view>

  <!-- ===== Main Page Body ===== -->
  <view class="page-body">

    <!-- Search Bar -->
    <view class="search-section">
      <view class="search-bar-inner">
        <text class="search-bar-icon">ğŸ”</text>
        <input
          class="search-bar-input"
          type="text"
          placeholder="{{currentGame === 'fab' ? 'æœç´¢ Flesh and Blood å¡ç‰Œ...' : 'æœç´¢å¡ç‰Œã€ç³»åˆ—æˆ–è§„åˆ™...'}}"
          placeholder-style="color: #a89a7a; font-size: 28rpx;"
          value="{{searchQuery}}"
          bindinput="onSearchInput"
          bindconfirm="onSearch"
          confirm-type="search"
        />
      </view>
    </view>

    <!-- Quick Actions grid -->
    <view class="quick-grid">
      <view class="quick-card" bindtap="goPriceLists">
        <view class="quick-icon-box quick-icon-primary">
          <text class="quick-icon-text">â‰¡</text>
        </view>
        <view class="quick-text-col">
          <text class="quick-title">ä»·æ ¼åˆ—è¡¨</text>
          <text class="quick-desc">ç®¡ç†ä¸å¯¼å‡º</text>
        </view>
      </view>
      <view class="quick-card" bindtap="goHistory">
        <view class="quick-icon-box quick-icon-orange">
          <text class="quick-icon-text">â—·</text>
        </view>
        <view class="quick-text-col">
          <text class="quick-title">æµè§ˆè¶³è¿¹</text>
          <text class="quick-desc">æŸ¥è¯¢å†å²</text>
        </view>
      </view>
    </view>

    <!-- ======== FAB Mode ======== -->
    <block wx:if="{{currentGame === 'fab'}}">

      <!-- Hero Classes -->
      <view class="section-block">
        <view class="section-label-row">
          <text class="section-label-icon">âš”ï¸</text>
          <text class="section-label-text">è‹±é›„èŒä¸š</text>
        </view>
        <view class="fab-class-grid">
          <view
            wx:for="{{fabClasses}}"
            wx:key="name"
            class="fab-class-item {{item.colorClass}}"
            data-name="{{item.name}}"
            bindtap="onFabClassTap"
          >
            <text class="fab-class-cn">{{item.cn}}</text>
            <text class="fab-class-en">{{item.name}}</text>
          </view>
        </view>
      </view>

      <!-- FAB Formats -->
      <view class="section-block">
        <view class="section-label-row">
          <text class="section-label-icon">ğŸ›¡ï¸</text>
          <text class="section-label-text">èµ›åˆ¶</text>
        </view>
        <view class="format-grid">
          <view wx:for="{{fabFormats}}" wx:key="*this" class="format-cell">
            <text class="format-cell-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- FAB Intro Card -->
      <view class="section-block">
        <view class="fab-intro-panel">
          <text class="fab-intro-title">å…³äº Flesh and Blood</text>
          <text class="fab-intro-body">Flesh and Blood æ˜¯ä¸€æ¬¾ç”± Legend Story Studios å‡ºå“çš„åŠ¨ä½œå¡ç‰Œæ¸¸æˆã€‚ç©å®¶æ‰®æ¼”è‹±é›„ï¼Œåœ¨å›åˆåˆ¶å¯¹æˆ˜ä¸­ä½¿ç”¨æŠ€èƒ½ã€æ­¦å™¨å’Œè£…å¤‡ç‰Œã€‚</text>
          <view class="fab-intro-link" bindtap="goFabLibrary">
            <text class="fab-link-icon">ğŸ”</text>
            <text class="fab-link-text">å¼€å§‹æœç´¢ FAB å¡ç‰Œ</text>
          </view>
        </view>
      </view>

    </block>

    <!-- ======== MTG Mode ======== -->
    <block wx:else>

      <!-- å¸‚åœºåŠ¨å‘ -->
      <view class="section-block">
        <view class="section-label-row">
          <text class="section-label-icon">ğŸ“ˆ</text>
          <text class="section-label-text">å¸‚åœºåŠ¨å‘ (CN)</text>
        </view>

        <view wx:if="{{hotLoading}}" class="loading-box">
          <view class="loading-spinner"></view>
        </view>

        <view wx:elif="{{hotCards.length === 0}}" class="empty-mini">
          <text>æš‚æ— æ•°æ®ï¼Œä¸‹æ‹‰åˆ·æ–°</text>
        </view>

        <view wx:else class="market-list">
          <view
            wx:for="{{hotCards}}"
            wx:key="id"
            class="market-row"
            data-id="{{item.id}}"
            bindtap="onCardTap"
          >
            <view class="market-avatar-wrap">
              <image class="market-avatar-img" src="{{item.image}}" mode="aspectFill" lazy-load />
            </view>
            <view class="market-info-col">
              <text class="market-name">{{item.nameCn || item.nameEn}}</text>
              <text class="market-name-en">{{item.nameEn}}</text>
            </view>
            <view class="market-price-col">
              <text class="market-price-main">{{item.priceCny ? 'Â¥' + item.priceCny : item.priceUsd ? '$' + item.priceUsd : 'N/A'}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç¤¾åŒºçƒ­é—¨ horizontal scroll -->
      <view class="section-block-nopx">
        <view class="section-label-row-px">
          <text class="section-label-icon">ğŸ”¥</text>
          <text class="section-label-text">ç¤¾åŒºçƒ­é—¨</text>
        </view>
        <view wx:if="{{recentLoading}}" class="loading-box">
          <view class="loading-spinner"></view>
        </view>
        <scroll-view wx:else scroll-x show-scrollbar="{{false}}" class="h-scroll-view">
          <view class="h-scroll-inner">
            <view
              wx:for="{{recentCards}}"
              wx:key="id"
              class="h-card"
              data-id="{{item.id}}"
              bindtap="onCardTap"
            >
              <image class="h-card-img" src="{{item.image}}" mode="aspectFill" lazy-load />
              <text class="h-card-name">{{item.nameCn || item.nameEn}}</text>
              <text class="h-card-price">{{item.priceCny ? 'Â¥' + item.priceCny : '--'}}</text>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- èµ›åˆ¶ format grid -->
      <view class="section-block">
        <view class="format-grid">
          <view
            wx:for="{{formats}}"
            wx:key="name"
            class="format-cell"
            data-query="{{item.query}}"
            bindtap="onFormatTap"
          >
            <text class="format-cell-text">{{item.name}}</text>
          </view>
        </view>
      </view>

    </block>

    <view style="height: 48rpx;"></view>
  </view>
</view>
