<view class="page-home">

  <!-- ===== é¡¶éƒ¨æ ‡é¢˜æ  ===== -->
  <view class="page-header">
    <text class="page-title">{{currentGame === 'fab' ? 'å‘ç° Â· FAB' : 'å‘ç°'}}</text>
    <view wx:if="{{currentGame === 'fab'}}" class="header-icon-box">
      <text style="font-size: 36rpx;">âš”ï¸</text>
    </view>
  </view>

  <!-- ===== æœç´¢æ¡† ===== -->
  <view class="px-container">
    <view class="search-bar">
      <text class="search-icon">ğŸ”</text>
      <input
        class="search-input"
        type="text"
        placeholder="{{currentGame === 'fab' ? 'æœç´¢ Flesh and Blood å¡ç‰Œ...' : 'æœç´¢å¡ç‰Œã€ç³»åˆ—æˆ–è§„åˆ™...'}}"
        placeholder-style="color: #8a7a5a; font-size: 28rpx;"
        value="{{searchQuery}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
        confirm-type="search"
      />
    </view>
  </view>

  <!-- ===== å¿«é€Ÿå…¥å£ (å…±ç”¨) ===== -->
  <view class="quick-actions px-container">
    <view class="action-card" bindtap="goPriceLists">
      <view class="action-icon-box action-icon-primary">
        <text style="font-size: 36rpx;">ğŸ“‹</text>
      </view>
      <view style="flex: 1;">
        <text class="action-title">ä»·æ ¼åˆ—è¡¨</text>
        <text class="action-desc">ç®¡ç†ä¸å¯¼å‡º</text>
      </view>
      <text style="color: #8a7a5a; font-size: 32rpx;">â€º</text>
    </view>
    <view class="action-card" bindtap="goHistory">
      <view class="action-icon-box action-icon-orange">
        <text style="font-size: 36rpx;">ğŸ•</text>
      </view>
      <view style="flex: 1;">
        <text class="action-title">æµè§ˆè¶³è¿¹</text>
        <text class="action-desc">æŸ¥è¯¢å†å²</text>
      </view>
      <text style="color: #8a7a5a; font-size: 32rpx;">â€º</text>
    </view>
  </view>

  <!-- =============== FAB æ¨¡å¼å†…å®¹ =============== -->
  <block wx:if="{{currentGame === 'fab'}}">

    <!-- FAB è‹±é›„èŒä¸š -->
    <view class="section px-container">
      <view class="section-header">
        <text style="font-size: 32rpx; margin-right: 8rpx;">âš”ï¸</text>
        <text class="section-title">è‹±é›„èŒä¸š</text>
      </view>
      <view class="fab-class-grid">
        <view
          wx:for="{{fabClasses}}"
          wx:key="name"
          class="fab-class-cell"
          style="border-color: {{item.color}}33; background-color: {{item.color}}0D;"
          data-name="{{item.name}}"
          bindtap="onFabClassTap"
        >
          <text class="fab-class-cn" style="color: {{item.color}};">{{item.cn}}</text>
          <text class="fab-class-en">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- FAB èµ›åˆ¶ -->
    <view class="section px-container">
      <view class="section-header">
        <text style="font-size: 32rpx; margin-right: 8rpx;">ğŸ›¡ï¸</text>
        <text class="section-title">èµ›åˆ¶</text>
      </view>
      <view class="format-grid">
        <view
          wx:for="{{fabFormats}}"
          wx:key="name"
          class="format-cell"
        >
          <text class="format-cell-label">{{item.name}}</text>
        </view>
      </view>
    </view>

    <!-- FAB ä»‹ç»å¡ç‰‡ -->
    <view class="section px-container">
      <view class="fab-intro-card">
        <text class="fab-intro-title">å…³äº Flesh and Blood</text>
        <text class="fab-intro-text">Flesh and Blood æ˜¯ä¸€æ¬¾ç”± Legend Story Studios å‡ºå“çš„åŠ¨ä½œå¡ç‰Œæ¸¸æˆã€‚ç©å®¶æ‰®æ¼”è‹±é›„ï¼Œåœ¨å›åˆåˆ¶å¯¹æˆ˜ä¸­ä½¿ç”¨æŠ€èƒ½ã€æ­¦å™¨å’Œè£…å¤‡ç‰Œã€‚</text>
        <view class="fab-intro-link" bindtap="goFabLibrary">
          <text style="font-size: 24rpx;">ğŸ”</text>
          <text class="fab-intro-link-text">å¼€å§‹æœç´¢ FAB å¡ç‰Œ</text>
        </view>
      </view>
    </view>

  </block>

  <!-- =============== MTG æ¨¡å¼å†…å®¹ =============== -->
  <block wx:else>

    <!-- å¸‚åœºåŠ¨å‘ -->
    <view class="section px-container">
      <view class="section-header">
        <text style="font-size: 32rpx; margin-right: 8rpx;">ğŸ“ˆ</text>
        <text class="section-title">å¸‚åœºåŠ¨å‘ (CN)</text>
      </view>

      <view wx:if="{{hotLoading}}" class="loading-container">
        <view class="loading-spinner"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <view wx:elif="{{hotCards.length === 0}}" class="empty-state" style="padding: 48rpx 0;">
        <text class="empty-icon">ğŸ“Š</text>
        <text class="empty-text">æš‚æ— æ•°æ®ï¼Œä¸‹æ‹‰åˆ·æ–°é‡è¯•</text>
      </view>

      <view wx:else>
        <view
          wx:for="{{hotCards}}"
          wx:key="id"
          class="market-row"
          data-id="{{item.id}}"
          bindtap="onCardTap"
        >
          <image class="market-avatar" src="{{item.image}}" mode="aspectFill" lazy-load />
          <view class="market-info">
            <text class="market-name-cn">{{item.nameCn || item.nameEn}}</text>
            <text class="market-name-en">{{item.nameEn}}</text>
          </view>
          <view class="market-price-col">
            <text class="market-price-cny">{{item.priceCny ? 'Â¥' + item.priceCny : '--'}}</text>
            <text class="market-price-usd">{{item.priceUsd ? '$' + item.priceUsd : ''}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç¤¾åŒºçƒ­é—¨ -->
    <view class="section">
      <view class="section-header px-container">
        <text style="font-size: 32rpx; margin-right: 8rpx;">ğŸ”¥</text>
        <text class="section-title">ç¤¾åŒºçƒ­é—¨</text>
      </view>

      <view wx:if="{{recentLoading}}" class="loading-container">
        <view class="loading-spinner"></view>
      </view>

      <scroll-view wx:else scroll-x class="card-h-scroll" show-scrollbar="{{false}}">
        <view class="card-h-inner">
          <view
            wx:for="{{recentCards}}"
            wx:key="id"
            class="h-card"
            data-id="{{item.id}}"
            bindtap="onCardTap"
          >
            <image class="h-card-image" src="{{item.image}}" mode="aspectFill" lazy-load />
            <view class="h-card-info">
              <text class="h-card-name">{{item.nameCn || item.nameEn}}</text>
              <text class="h-card-price">{{item.priceCny ? 'Â¥' + item.priceCny : '--'}}</text>
            </view>
          </view>
          <view wx:if="{{recentCards.length === 0}}" class="h-card-empty">
            <text style="color: #8a7a5a; font-size: 24rpx;">æš‚æ— æ•°æ®</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- èµ›åˆ¶å¿«é€Ÿå…¥å£ -->
    <view class="section px-container">
      <view class="section-header">
        <text style="font-size: 32rpx; margin-right: 8rpx;">âš¡</text>
        <text class="section-title">å¿«é€Ÿèµ›åˆ¶</text>
      </view>
      <view class="format-grid">
        <view
          wx:for="{{formats}}"
          wx:key="key"
          class="format-cell"
          data-query="{{item.query}}"
          bindtap="onFormatTap"
        >
          <text class="format-cell-label">{{item.name}}</text>
        </view>
      </view>
    </view>

  </block>

  <view style="height: 32rpx;"></view>

</view>
