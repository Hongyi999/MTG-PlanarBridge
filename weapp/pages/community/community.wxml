<view class="page-community">

  <!-- ===== é¡¶éƒ¨æ ‡é¢˜ ===== -->
  <view class="comm-header px-container">
    <text class="page-title">ç¤¾åŒº</text>
  </view>

  <!-- ===== æ ‡ç­¾ç­›é€‰ ===== -->
  <view class="filter-bar">
    <scroll-view scroll-x class="filter-scroll">
      <view
        wx:for="{{filterOptions}}"
        wx:key="key"
        class="filter-tab {{activeFilter === item.key ? 'active' : ''}}"
        data-key="{{item.key}}"
        bindtap="onFilterTap"
      >
        {{item.label}}
      </view>
    </scroll-view>
  </view>

  <!-- ===== åŠ è½½ä¸­ ===== -->
  <view wx:if="{{loading}}" class="loading-center">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ===== å¸–å­åˆ—è¡¨ ===== -->
  <view wx:if="{{!loading}}" class="posts-list px-container">
    <block wx:for="{{posts}}" wx:key="id">
      <view
        wx:if="{{activeFilter === 'all' || item.type === activeFilter}}"
        class="community-post"
      >
        <!-- å¸–å­å¤´éƒ¨ -->
        <view class="post-header">
          <image
            class="avatar-small"
            src="{{item.authorAvatar}}"
            wx:if="{{item.authorAvatar}}"
            mode="aspectFill"
          />
          <view wx:else class="avatar-small avatar-placeholder">
            <text style="font-size: 28rpx; color: #8b6914;">â—‰</text>
          </view>
          <view class="post-header-info">
            <text class="post-author-name">{{item.authorName}}</text>
            <text class="post-time-text">{{item.timeAgo}}</text>
          </view>
          <text class="type-tag tag-{{item.type}}">{{item.typeLabel}}</text>
        </view>

        <!-- å¸–å­æ­£æ–‡ -->
        <text class="post-body">{{item.content}}</text>

        <!-- å¸–å­å›¾ç‰‡ -->
        <view wx:if="{{item.images.length > 0}}" class="post-images">
          <image
            wx:for="{{item.images}}"
            wx:for-item="img"
            wx:for-index="imgIdx"
            wx:key="imgIdx"
            class="post-image {{item.images.length === 1 ? 'single' : ''}} {{item.images.length === 2 ? 'double' : ''}} {{item.images.length >= 3 ? 'triple' : ''}}"
            src="{{img}}"
            mode="aspectFill"
            data-urls="{{item.images}}"
            data-current="{{img}}"
            bindtap="onPostImageTap"
          />
        </view>

        <!-- å…³è”å¡ç‰Œ -->
        <view
          wx:if="{{item.cardName}}"
          class="post-linked-card"
          data-id="{{item.scryfallId}}"
          bindtap="onCardRefTap"
        >
          <image
            class="linked-card-image"
            src="{{item.cardImage}}"
            mode="aspectFit"
            wx:if="{{item.cardImage}}"
          />
          <view class="linked-card-info">
            <text class="linked-card-name">{{item.cardName}}</text>
            <text wx:if="{{item.price}}" class="linked-card-price">Â¥{{item.price}}</text>
          </view>
          <text style="font-size: 24rpx; color: #8a7a5a;">â†’</text>
        </view>

        <!-- å¸–å­æ“ä½œ -->
        <view class="post-actions">
          <view class="post-action" data-id="{{item.id}}" bindtap="onLike">
            <text class="action-icon">â™¡</text>
            <text class="action-count">{{item.likes}}</text>
          </view>
          <view class="post-action">
            <text class="action-icon">â—‡</text>
            <text class="action-count">{{item.comments}}</text>
          </view>
        </view>
      </view>
    </block>
  </view>

  <!-- ===== ç©ºçŠ¶æ€ ===== -->
  <view wx:if="{{!loading && posts.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“‹</text>
    <text class="empty-title">æš‚æ— å¸–å­</text>
    <text class="empty-sub">æ¥å‘ç¬¬ä¸€æ¡å§ï¼</text>
  </view>

  <!-- ===== å‘å¸–æŒ‰é’® ===== -->
  <view class="fab-button" bindtap="goCreatePost">
    <text class="fab-icon">âœ</text>
  </view>

</view>
